{% extends "base.html" %}

{% block content %}

<!-- The main puzzle interface, with the puzzle and other panels in it -->
<div class="columns" id="puzzle-interface">
</div>

<script type="module">
    import { PuzzleUi } from '/assets_{{base.assets_version}}/scripts/puzzle-ui.js';

    {% if let Some(puzzle) = puzzle %}
    let puzzle = {
        id: "{{puzzle.puzzle_id}}",
        themes: "{{self.puzzle_themes_list().unwrap()}}",
        fen: "{{ puzzle.fen }}",
        moves: "{{ puzzle.moves }}",
        rating: {{ puzzle.rating }},
    };
    {% else %}
    let puzzle = null;
    {% endif %}

    let card = {
        review_count: {{ card.review_count }},
        ease: {{ card.ease }},
        due: "{{ Self::human_readable_due(card) }}",
        due_now: {{ Self::card_due_now(card) }},
        again_time: "{{ self.next_interval_human(Difficulty::Again) }}",
        hard_time: "{{ self.next_interval_human(Difficulty::Hard) }}",
        good_time: "{{ self.next_interval_human(Difficulty::Good) }}",
        easy_time: "{{ self.next_interval_human(Difficulty::Easy) }}",
    };

    let config = {
        puzzle,
        card,
        query: { mode: "{{ mode }}", min_rating: {{ min_rating }}, max_rating: {{ max_rating }} },
    };

    document.puzzle_ui = new PuzzleUi(document.getElementById("puzzle-interface"), config);

    // Get user stats.
    $.ajax(`/api/user/stats`)
        .done(function(data) {
            document.puzzle_ui.configure({ stats: data });
        })
        .fail(function(err) {
            console.error(`Failed to get user stats: ${err.responseText}`);
        });
</script>
{% endblock %}
